<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ³¨éŸ³ç¬¦è™Ÿå¤§å†’éšª</title>
    <style>
        :root {
            --bg: #FDF6E3;
            --text: #555;
            --correct: #6BCB77;
            --wrong: #FF6B6B;
        }

        body {
            font-family: "Microsoft JhengHei", "Rounded Mplus 1c", sans-serif;
            background-color: var(--bg);
            background-image: linear-gradient(180deg, #9FA5D5 0%, #E8F5C8 100%);
            background-attachment: fixed;
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        h1 {
            color: #fff;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin: 10px 0 20px;
            font-weight: 900;
        }

        .voice-control {
            font-size: 0.9rem;
            margin-bottom: 15px;
            color: #fff;
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .nav-container {
            background: rgba(255,255,255,0.9);
            padding: 8px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 40px;
            cursor: pointer;
            background-color: transparent;
            color: #888;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-btn.active {
            background-color: #4A89A6;
            color: white;
            box-shadow: 0 4px 10px rgba(74, 137, 166, 0.3);
        }

        .container {
            width: 95%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: none;
        }

        .container.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .symbol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(65px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .symbol-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 4px;
            font-size: 2rem;
            font-family: "Dela Gothic One", "Microsoft JhengHei", sans-serif; 
            cursor: pointer;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .symbol-btn:active { transform: scale(0.95); }
        .symbol-btn:hover { opacity: 0.9; transform: scale(1.05); z-index: 10; }

        /* å­¸ç¿’å€é¡¯ç¤ºæ¡†å„ªåŒ– */
        .display-area {
            text-align: center;
            padding: 20px;
            background: #fff;
            border-radius: 20px;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid #eee;
        }

        .big-symbol {
            font-size: 7rem;
            font-weight: 900;
            margin: 0;
            line-height: 1.1;
        }

        /* è©å½™å¡ç‰‡æ¨£å¼ */
        .examples {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .example-tag {
            background-color: #f8f9fa;
            border: 2px solid #e0e0e0;
            padding: 8px 15px;
            border-radius: 12px;
            font-size: 1.5rem;
            color: #555;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            transition: all 0.2s;
            position: relative;
        }

        .example-tag:hover {
            background-color: #e3f2fd;
            border-color: #4A89A6;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .example-tag:active {
            transform: scale(0.95);
        }

        /* æ³¨éŸ³ Ruby æ¨™ç±¤è¨­å®š */
        ruby {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 2px;
            vertical-align: middle;
        }
        
        rt {
            font-size: 0.5em; /* æ³¨éŸ³å­—é«”å¤§å° */
            color: #888;
            font-weight: normal;
            line-height: 1.2;
            margin-bottom: -2px; /* ç¨å¾®æ‹‰è¿‘è·Ÿåœ‹å­—çš„è·é›¢ */
        }

        /* èªéŸ³ icon */
        .sound-icon {
            font-size: 1rem;
            margin-left: 8px;
            opacity: 0.5;
        }

        /* æ¸¬é©—å€å¡Š */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: #f4f4f4;
            padding: 10px 20px;
            border-radius: 15px;
        }

        .score-board { font-size: 1.1rem; font-weight: bold; color: #4A89A6; }

        .play-quiz-btn {
            background-color: #4A89A6;
            color: white;
            font-size: 1.3rem;
            padding: 15px 0;
            width: 100%;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #366B84;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .play-quiz-btn:active { transform: translateY(5px); box-shadow: none; }
        .play-quiz-btn.next-mode { background-color: #E59372; box-shadow: 0 5px 0 #c27658; }

        /* ç‰¹æ•ˆé¡ */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; filter: brightness(0.7); }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        
        .correct-pop { animation: pop 0.4s; filter: brightness(1.2); box-shadow: 0 0 15px gold; z-index: 100; }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }

        .feedback-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            font-size: 12rem; z-index: 1000; pointer-events: none; transition: transform 0.3s;
            text-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .feedback-overlay.show { transform: translate(-50%, -50%) scale(1); }
        .particle { position: fixed; pointer-events: none; animation: fall 1s linear forwards; z-index: 999; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

    </style>
</head>
<body>

    <h1>ğŸŒˆ æ³¨éŸ³ç¬¦è™Ÿå¤§å†’éšª</h1>

    <div class="voice-control">
        ğŸ”Š ä½¿ç”¨ Google æ™ºæ…§ç™¼éŸ³ (é»æ“Šè©å½™å¯ç™¼éŸ³)
    </div>

    <div class="nav-container">
        <button class="nav-btn active" onclick="switchMode('learning')">ğŸ“– å­¸ç¿’å€</button>
        <button class="nav-btn" onclick="switchMode('quiz')">ğŸ® æŒ‘æˆ°å€</button>
    </div>

    <div id="learning-section" class="container active">
        <div class="symbol-grid" id="learning-grid"></div>
        <div class="display-area" id="learning-display">
            <h2 style="color:#aaa;">ğŸ‘‡ é»é¸ä¸Šæ–¹çš„è‰²å¡Šé–‹å§‹å­¸ç¿’</h2>
        </div>
    </div>

    <div id="quiz-section" class="container">
        <div class="quiz-header">
            <div class="score-board">ğŸ† é€£çºŒç­”å°ï¼š<span id="score-val">0</span> é¡Œ</div>
            <div id="quiz-status" style="color:#666;">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
        </div>
        <button id="quiz-control-btn" class="play-quiz-btn" onclick="handleQuizControl()">ğŸ”Š æ’­æ”¾é¡Œç›®è²éŸ³</button>
        <div class="symbol-grid" id="quiz-grid"></div>
    </div>

    <div id="feedback" class="feedback-overlay"></div>

<script>
    // --- 1. è³‡æ–™åº« (æ“´å……ï¼šåŠ å…¥è©³ç´°çš„æ³¨éŸ³æ¨™ç¤º) ---
    const zhuyinData = [
        { char: "ã„…", examples: [{w:"çˆ¸çˆ¸", p:"ã„…ã„šË‹ Ë™ã„…ã„š"}, {w:"åŒ…å­", p:"ã„…ã„  Ë™ã„—"}] },
        { char: "ã„†", examples: [{w:"è˜‹æœ", p:"ã„†ã„§ã„¥ËŠ ã„ã„¨ã„›Ë‡"}, {w:"æœ‹å‹", p:"ã„†ã„¥ËŠ ã„§ã„¡Ë‡"}] },
        { char: "ã„‡", examples: [{w:"åª½åª½", p:"ã„‡ã„š Ë™ã„‡ã„š"}, {w:"éºµåŒ…", p:"ã„‡ã„§ã„¢Ë‹ ã„…ã„ "}] },
        { char: "ã„ˆ", examples: [{w:"é£›æ©Ÿ", p:"ã„ˆã„Ÿ ã„ã„§"}, {w:"èœœèœ‚", p:"ã„‡ã„§Ë‹ ã„ˆã„¥"}] },
        { char: "ã„‰", examples: [{w:"å¼Ÿå¼Ÿ", p:"ã„‰ã„§Ë‹ Ë™ã„‰ã„§"}, {w:"è›‹ç³•", p:"ã„‰ã„¢Ë‹ ã„ã„ "}] },
        { char: "ã„Š", examples: [{w:"å…”å­", p:"ã„Šã„¨Ë‹ Ë™ã„—"}, {w:"å¤ªé™½", p:"ã„Šã„Ë‹ ã„§ã„¤ËŠ"}] },
        { char: "ã„‹", examples: [{w:"ç‰›å¥¶", p:"ã„‹ã„§ã„¡ËŠ ã„‹ã„Ë‡"}, {w:"å¥¶å¥¶", p:"ã„‹ã„Ë‡ Ë™ã„‹ã„"}] },
        { char: "ã„Œ", examples: [{w:"è€è™", p:"ã„Œã„ Ë‡ ã„ã„¨Ë‡"}, {w:"å¿«æ¨‚", p:"ã„ã„¨ã„Ë‹ ã„Œã„œË‹"}] },
        { char: "ã„", examples: [{w:"å“¥å“¥", p:"ã„ã„œ Ë™ã„ã„œ"}, {w:"è˜‹æœ", p:"ã„†ã„§ã„¥ËŠ ã„ã„¨ã„›Ë‡"}] },
        { char: "ã„", examples: [{w:"æé¾", p:"ã„ã„¨ã„¥Ë‡ ã„Œã„¨ã„¥ËŠ"}, {w:"å¡ç‰‡", p:"ã„ã„šË‡ ã„†ã„§ã„¢Ë‹"}] },
        { char: "ã„", examples: [{w:"èŠ±æœµ", p:"ã„ã„¨ã„š ã„‰ã„¨ã„›Ë‡"}, {w:"çŒ´å­", p:"ã„ã„¡ËŠ Ë™ã„—"}] },
        { char: "ã„", examples: [{w:"é›è›‹", p:"ã„ã„§ ã„‰ã„¢Ë‹"}, {w:"ç©æœ¨", p:"ã„ã„§ ã„‡ã„¨Ë‹"}] },
        { char: "ã„‘", examples: [{w:"æ°£çƒ", p:"ã„‘ã„§Ë‹ ã„‘ã„§ã„¡ËŠ"}, {w:"ä¼éµ", p:"ã„‘ã„§Ë‹ ã„œËŠ"}] },
        { char: "ã„’", examples: [{w:"è¥¿ç“œ", p:"ã„’ã„§ ã„ã„¨ã„š"}, {w:"æ˜Ÿæ˜Ÿ", p:"ã„’ã„§ã„¥ ã„’ã„§ã„¥"}] },
        { char: "ã„“", examples: [{w:"èœ˜è››", p:"ã„“ ã„“ã„¨"}, {w:"æ¡Œå­", p:"ã„“ã„¨ã„› Ë™ã„—"}] },
        { char: "ã„”", examples: [{w:"åƒé£¯", p:"ã„” ã„ˆã„¢Ë‹"}, {w:"è»Šå­", p:"ã„”ã„œ Ë™ã„—"}] },
        { char: "ã„•", examples: [{w:"ç…å­", p:"ã„• Ë™ã„—"}, {w:"æ›¸æœ¬", p:"ã„•ã„¨ ã„…ã„£Ë‡"}] },
        { char: "ã„–", examples: [{w:"ç†±ç‹—", p:"ã„–ã„œË‹ ã„ã„¡Ë‡"}, {w:"æ—¥æœŸ", p:"ã„–Ë‹ ã„‘ã„§ËŠ"}] },
        { char: "ã„—", examples: [{w:"æ—©å®‰", p:"ã„—ã„ Ë‡ ã„¢"}, {w:"èµ°è·¯", p:"ã„—ã„¡Ë‡ ã„Œã„¨Ë‹"}] },
        { char: "ã„˜", examples: [{w:"è‰è“", p:"ã„˜ã„ Ë‡ ã„‡ã„ŸËŠ"}, {w:"å»æ‰€", p:"ã„˜ã„œË‹ ã„™ã„¨ã„›Ë‡"}] },
        { char: "ã„™", examples: [{w:"æ¾é¼ ", p:"ã„™ã„¨ã„¥ ã„•ã„¨Ë‡"}, {w:"æ£®æ—", p:"ã„™ã„£ ã„Œã„§ã„£ËŠ"}] },
        { char: "ã„§", examples: [{w:"è¡£æœ", p:"ã„§ ã„ˆã„¨ËŠ"}, {w:"æ¤…å­", p:"ã„§Ë‡ Ë™ã„—"}] },
        { char: "ã„¨", examples: [{w:"çƒé¾œ", p:"ã„¨ ã„ã„¨ã„Ÿ"}, {w:"å¨ƒå¨ƒ", p:"ã„¨ã„šËŠ Ë™ã„¨ã„š"}] },
        { char: "ã„©", examples: [{w:"é›¨å‚˜", p:"ã„©Ë‡ ã„™ã„¢Ë‡"}, {w:"ç‰ç±³", p:"ã„©Ë‹ ã„‡ã„§Ë‡"}] },
        { char: "ã„š", examples: [{w:"é´¨å­", p:"ã„§ã„š Ë™ã„—"}, {w:"ç‰™é½’", p:"ã„§ã„šËŠ ã„”Ë‡"}] },
        { char: "ã„›", examples: [{w:"è–„è·", p:"ã„…ã„›Ë‹ Ë™ã„ã„œ"}, {w:"ä½›ç¥–", p:"ã„ˆã„›ËŠ ã„—ã„¨Ë‡"}] },
        { char: "ã„œ", examples: [{w:"å¤©éµ", p:"ã„Šã„§ã„¢ ã„œËŠ"}, {w:"å¯æ¨‚", p:"ã„ã„œË‡ ã„Œã„œË‹"}] },
        { char: "ã„", examples: [{w:"çˆºçˆº", p:"ã„§ã„ËŠ Ë™ã„§ã„"}, {w:"è‘‰å­", p:"ã„§ã„Ë‹ Ë™ã„—"}] },
        { char: "ã„", examples: [{w:"å¥¶å¥¶", p:"ã„‹ã„Ë‡ Ë™ã„‹ã„"}, {w:"æµ·è±š", p:"ã„ã„Ë‡ ã„Šã„¨ã„£ËŠ"}] },
        { char: "ã„Ÿ", examples: [{w:"å¦¹å¦¹", p:"ã„‡ã„ŸË‹ Ë™ã„‡ã„Ÿ"}, {w:"æ¯å­", p:"ã„…ã„Ÿ Ë™ã„—"}] },
        { char: "ã„ ", examples: [{w:"å°è²“", p:"ã„’ã„§ã„ Ë‡ ã„‡ã„ "}, {w:"è‰è“", p:"ã„˜ã„ Ë‡ ã„‡ã„ŸËŠ"}] },
        { char: "ã„¡", examples: [{w:"çŒ´å­", p:"ã„ã„¡ËŠ Ë™ã„—"}, {w:"å°ç‹—", p:"ã„’ã„§ã„ Ë‡ ã„ã„¡Ë‡"}] },
        { char: "ã„¢", examples: [{w:"é›è›‹", p:"ã„ã„§ ã„‰ã„¢Ë‹"}, {w:"æ™šå®‰", p:"ã„¨ã„¢Ë‡ ã„¢"}] },
        { char: "ã„£", examples: [{w:"å¤§é–€", p:"ã„‰ã„šË‹ ã„‡ã„£ËŠ"}, {w:"æ£®æ—", p:"ã„™ã„£ ã„Œã„§ã„£ËŠ"}] },
        { char: "ã„¤", examples: [{w:"ç³–æœ", p:"ã„Šã„¤ËŠ ã„ã„¨ã„›Ë‡"}, {w:"å¤ªé™½", p:"ã„Šã„Ë‹ ã„§ã„¤ËŠ"}] },
        { char: "ã„¥", examples: [{w:"èœœèœ‚", p:"ã„‡ã„§Ë‹ ã„ˆã„¥"}, {w:"é›»ç‡ˆ", p:"ã„‰ã„§ã„¢Ë‹ ã„‰ã„¥"}] },
        { char: "ã„¦", examples: [{w:"è€³æœµ", p:"ã„¦Ë‡ ã„‰ã„¨ã„›"}, {w:"å…’å­", p:"ã„¦ËŠ Ë™ã„—"}] }
    ];

    const colorPalette = ['#4A89A6', '#E59372', '#F08488', '#88B775', '#4AAABF', '#C784A2', '#4B99B6', '#D67B86'];
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    // ç³»çµ±è®Šæ•¸
    const learningGrid = document.getElementById('learning-grid');
    const quizGrid = document.getElementById('quiz-grid');
    const learningDisplay = document.getElementById('learning-display');
    const feedbackOverlay = document.getElementById('feedback');
    const quizStatus = document.getElementById('quiz-status');
    const scoreVal = document.getElementById('score-val');
    const quizControlBtn = document.getElementById('quiz-control-btn');

    let currentScore = 0;
    let currentQuizAnswer = null;
    let isQuizActive = false;
    let wrongCount = 0;

    // --- éŸ³æ•ˆèˆ‡èªéŸ³ ---
    function playTone(freq, type, duration) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.value = freq;
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
        osc.stop(audioCtx.currentTime + duration);
    }
    
    function playSound(type) {
        if (type === 'click') playTone(800, 'triangle', 0.05);
        if (type === 'correct') { playTone(523, 'sine', 0.1); setTimeout(()=>playTone(659, 'sine', 0.3), 100); }
        if (type === 'wrong') { playTone(150, 'sawtooth', 0.15); setTimeout(()=>playTone(120, 'sawtooth', 0.3), 150); }
    }

    function playVoice(text) {
        // ä½¿ç”¨ Google ç¿»è­¯ API
        const url = `https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&tl=zh-TW&q=${encodeURIComponent(text)}`;
        const audio = new Audio(url);
        audio.play().catch(e => {
            console.log("ç¶²è·¯èªéŸ³å¤±æ•—ï¼Œåˆ‡æ›ç³»çµ±èªéŸ³");
            const synth = window.speechSynthesis;
            const u = new SpeechSynthesisUtterance(text);
            u.lang = "zh-TW";
            synth.speak(u);
        });
    }

    // --- åˆå§‹åŒ–æŒ‰éˆ• ---
    zhuyinData.forEach((item, index) => {
        const bgColor = colorPalette[index % colorPalette.length];
        
        // å­¸ç¿’æŒ‰éˆ•
        const btnL = createBtn(item, bgColor);
        btnL.onclick = () => { playSound('click'); showLearningDetail(item, bgColor); };
        learningGrid.appendChild(btnL);

        // æ¸¬é©—æŒ‰éˆ•
        const btnQ = createBtn(item, bgColor);
        btnQ.onclick = () => checkAnswer(item.char, btnQ);
        quizGrid.appendChild(btnQ);
    });

    function createBtn(item, color) {
        const btn = document.createElement('button');
        btn.className = 'symbol-btn';
        btn.innerText = item.char;
        btn.style.backgroundColor = color;
        return btn;
    }

    // --- å­¸ç¿’å€é‚è¼¯ (æ›´æ–°ï¼šç”Ÿæˆ Ruby æ¨™ç±¤èˆ‡é»æ“Šäº‹ä»¶) ---
    function showLearningDetail(item, color) {
        // ç”Ÿæˆè©å½™å¡ç‰‡ HTML
        const wordsHtml = item.examples.map(ex => {
            // åˆ†å‰²å­—ä¸²ä»¥å°æ‡‰æ¯å€‹å­—çš„æ³¨éŸ³ (ç°¡å–®è™•ç†ï¼šå‡è¨­æ³¨éŸ³æ˜¯ç”¨ç©ºæ ¼åˆ†é–‹)
            const chars = ex.w.split('');
            const bopomofos = ex.p.split(' ');
            
            // çµ„åˆ <ruby> æ¨™ç±¤
            let rubyHtml = '';
            chars.forEach((char, i) => {
                // å¦‚æœæœ‰å°æ‡‰çš„æ³¨éŸ³å°±é¡¯ç¤ºï¼Œæ²’æœ‰å°±ç©ºè‘—
                const bpm = bopomofos[i] || ''; 
                rubyHtml += `<ruby>${char}<rt>${bpm}</rt></ruby>`;
            });

            // å›å‚³å¯é»æ“Šçš„ div
            return `<div class="example-tag" onclick="playVoice('${ex.w}'); event.stopPropagation();">
                        ${rubyHtml} <span class="sound-icon">ğŸ”Š</span>
                    </div>`;
        }).join('');

        learningDisplay.innerHTML = `
            <div class="big-symbol" style="color:${color}">${item.char}</div>
            <div class="examples">${wordsHtml}</div>
        `;
        playVoice(item.char);
    }

    // --- æ¸¬é©—å€é‚è¼¯ ---
    function switchMode(mode) {
        playSound('click');
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

        if(mode === 'learning') {
            document.getElementById('learning-section').classList.add('active');
            document.querySelectorAll('.nav-btn')[0].classList.add('active');
        } else {
            document.getElementById('quiz-section').classList.add('active');
            document.querySelectorAll('.nav-btn')[1].classList.add('active');
            resetQuizUI();
        }
    }

    function handleQuizControl() {
        if (isQuizActive) {
            playVoice(currentQuizAnswer);
            quizControlBtn.style.transform = "scale(0.95)";
            setTimeout(() => quizControlBtn.style.transform = "scale(1)", 100);
        } else {
            startNewQuestion();
        }
    }

    function startNewQuestion() {
        const randomIndex = Math.floor(Math.random() * zhuyinData.length);
        currentQuizAnswer = zhuyinData[randomIndex].char;
        isQuizActive = true;
        wrongCount = 0;
        
        quizStatus.innerText = "ğŸ‘‚ è«‹ä»”ç´°è½ï¼Œé¸å‡ºæ­£ç¢ºçš„æ³¨éŸ³";
        quizStatus.style.color = "#4A89A6";
        quizControlBtn.innerText = "ğŸ”Š é‡è½ä¸€æ¬¡";
        quizControlBtn.classList.remove('next-mode');
        
        document.querySelectorAll('#quiz-grid .symbol-btn').forEach(btn => {
            btn.classList.remove('shake', 'correct-pop');
            btn.style.opacity = "1";
        });
        
        playVoice(currentQuizAnswer);
    }
    
    function resetQuizUI() {
        isQuizActive = false;
        quizControlBtn.innerText = "ğŸ”Š é–‹å§‹å‡ºé¡Œ";
        quizControlBtn.classList.remove('next-mode');
        quizStatus.innerText = "æŒ‰ä¸‹æŒ‰éˆ•é–‹å§‹æŒ‘æˆ°ï¼";
    }

    function checkAnswer(selectedChar, btnElement) {
        if (!isQuizActive) {
            playSound('wrong'); 
            quizStatus.innerText = "ğŸ‘‰ è«‹å…ˆæŒ‰ã€Œä¸‹ä¸€é¡Œã€é–‹å§‹å–”ï¼";
            quizControlBtn.classList.add('next-mode');
            return;
        }

        if (selectedChar === currentQuizAnswer) {
            playSound('correct');
            showFeedback(true);
            btnElement.classList.add('correct-pop');
            fireConfetti();
            
            currentScore++;
            scoreVal.innerText = currentScore;
            
            quizStatus.innerText = "âœ¨ ç­”å°äº†ï¼å¥½æ£’ï¼";
            playVoice("ç­”å°äº†");
            endRound(); 
        } else {
            playSound('wrong');
            btnElement.classList.add('shake');
            setTimeout(() => btnElement.classList.remove('shake'), 500);
            
            wrongCount++;
            if (wrongCount >= 3) {
                showFeedback(false);
                quizStatus.innerText = `æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${currentQuizAnswer}`;
                playVoice(`æ­£ç¢ºç­”æ¡ˆæ˜¯${currentQuizAnswer}`);
                document.querySelectorAll('#quiz-grid .symbol-btn').forEach(b => {
                    if(b.innerText === currentQuizAnswer) b.classList.add('correct-pop');
                });
                currentScore = 0;
                scoreVal.innerText = 0;
                endRound();
            } else {
                quizStatus.innerText = "ğŸ’ª åŠ æ²¹ï¼Œå¯ä»¥æŒ‰æŒ‰éˆ•é‡è½ä¸€æ¬¡ï¼";
            }
        }
    }

    function endRound() {
        isQuizActive = false;
        quizControlBtn.innerText = "â¡ï¸ ä¸‹ä¸€é¡Œ";
        quizControlBtn.classList.add('next-mode');
    }

    function showFeedback(isCorrect) {
        feedbackOverlay.innerText = isCorrect ? "â­•" : "âŒ";
        feedbackOverlay.style.color = isCorrect ? "var(--correct)" : "var(--wrong)";
        feedbackOverlay.classList.add('show');
        setTimeout(() => feedbackOverlay.classList.remove('show'), 800);
    }

    function fireConfetti() {
        const colors = colorPalette;
        for(let i=0; i<30; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            p.style.left = Math.random() * 100 + 'vw';
            p.style.top = '-10px';
            p.style.width = (Math.random() * 10 + 5) + 'px';
            p.style.height = (Math.random() * 10 + 5) + 'px';
            p.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1500);
        }
    }
</script>

</body>
</html>